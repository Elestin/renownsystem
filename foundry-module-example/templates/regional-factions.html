<div class="regional-factions-container">
    <div class="regional-factions-header">
        <h2>Regional Power Dynamics</h2>
        <p class="help-text">
            Manage regional authority, faction power distribution, and inter-faction relationships.
            Power in each region is balanced: Faction Power + Authority = 100%
        </p>
    </div>

    <!-- Region Management Section -->
    <div class="section region-management">
        <h3>Region Management</h3>
        <div class="form-row">
            <input type="text" id="new-region-name" placeholder="Enter region name..." />
            <input type="number" id="new-region-authority" min="0" max="100" value="20" placeholder="Authority (0-100)" />
            <button type="button" class="add-region-btn" data-action="add-region">
                <i class="fas fa-plus"></i> Add Region
            </button>
        </div>
    </div>

    <!-- Faction Assignment Section -->
    <div class="section faction-assignment">
        <h3>Assign Faction to Region</h3>
        <div class="form-row">
            <select id="faction-select-for-region" class="faction-select">
                <option value="">Select Faction...</option>
                {{#each factions}}
                <option value="{{this.name}}">{{this.name}}</option>
                {{/each}}
            </select>
            <select id="region-select-for-faction" class="region-select">
                <option value="">Select Region...</option>
            </select>
            <button type="button" class="assign-faction-btn" data-action="assign-faction">
                <i class="fas fa-map-marker-alt"></i> Assign Faction
            </button>
        </div>
        <div class="form-row">
            <input type="text" id="faction-leader" placeholder="Leader (optional)" />
            <input type="text" id="faction-description" placeholder="Description (optional)" />
            <input type="text" id="faction-goals" placeholder="Goals (optional)" />
        </div>
    </div>

    <!-- Interaction Setup Section -->
    <div class="section interaction-setup">
        <h3>Set Faction Interactions</h3>
        <div class="form-row">
            <select id="faction-a-select" class="faction-region-select">
                <option value="">Select Faction A...</option>
            </select>
            <select id="interaction-type-select">
                <option value="war">War (-10 power effect)</option>
                <option value="alliance">Alliance (+5 power effect)</option>
                <option value="trade">Trade Agreement (+3 power effect)</option>
            </select>
            <select id="faction-b-select" class="faction-region-select">
                <option value="">Select Faction B...</option>
            </select>
            <button type="button" class="set-interaction-btn" data-action="set-interaction">
                <i class="fas fa-handshake"></i> Set Interaction
            </button>
        </div>
    </div>

    <!-- Regions Display -->
    <div class="regions-display">
        <div class="section-controls">
            <button type="button" class="roll-dice-btn" data-action="roll-dice">
                <i class="fas fa-dice"></i> Roll Dice (Simulate Power Changes)
            </button>
            <button type="button" class="export-regional-btn" data-action="export-regional">
                <i class="fas fa-download"></i> Export Regional Data
            </button>
            <button type="button" class="import-regional-btn" data-action="import-regional">
                <i class="fas fa-upload"></i> Import Regional Data
            </button>
            <input type="file" id="import-regional-file" accept=".json" style="display: none;" />
        </div>

        <div id="regions-container" class="regions-grid">
            <!-- Regions will be dynamically rendered here -->
        </div>
    </div>

    <!-- Event Log Section -->
    <div class="section event-log-section">
        <h3>Event Log</h3>
        <div class="event-log-controls">
            <button type="button" class="clear-log-btn" data-action="clear-log">
                <i class="fas fa-trash"></i> Clear Log
            </button>
        </div>
        <div id="event-log" class="event-log">
            <p class="no-events">No events yet. Roll the dice to simulate power changes.</p>
        </div>
    </div>
</div>

<style>
.regional-factions-container {
    padding: 10px;
}

.regional-factions-header h2 {
    margin-top: 0;
    color: var(--heading-color, #c9a338);
    font-family: var(--font-family, 'Cinzel');
}

.help-text {
    font-size: 0.9em;
    color: var(--text-color, #e2e2dc);
    opacity: 0.8;
    margin-bottom: 15px;
}

.section {
    margin-bottom: 20px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    border: 1px solid var(--table-border, #555);
}

.section h3 {
    margin-top: 0;
    color: var(--heading-color, #c9a338);
    font-size: 1.1em;
}

.form-row {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    flex-wrap: wrap;
}

.form-row input,
.form-row select {
    flex: 1;
    min-width: 150px;
    padding: 8px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid var(--table-border, #555);
    border-radius: 4px;
    color: var(--text-color, #e2e2dc);
    font-family: var(--font-family, 'Cinzel');
}

.form-row button {
    padding: 8px 15px;
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid var(--table-border, #555);
    border-radius: 4px;
    color: var(--text-color, #e2e2dc);
    font-family: var(--font-family, 'Cinzel');
    cursor: pointer;
    transition: background 0.3s;
}

.form-row button:hover {
    background: rgba(0, 0, 0, 0.8);
}

.section-controls {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.section-controls button {
    padding: 10px 15px;
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid var(--table-border, #555);
    border-radius: 4px;
    color: var(--text-color, #e2e2dc);
    font-family: var(--font-family, 'Cinzel');
    cursor: pointer;
    transition: background 0.3s;
}

.section-controls button:hover {
    background: rgba(0, 0, 0, 0.8);
}

.regions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 15px;
}

.region-card {
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid var(--table-border, #555);
    border-radius: 8px;
    padding: 15px;
}

.region-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.region-header h4 {
    margin: 0;
    color: var(--heading-color, #c9a338);
}

.region-controls {
    display: flex;
    gap: 5px;
}

.region-controls button {
    padding: 4px 8px;
    font-size: 0.8em;
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid var(--table-border, #555);
    border-radius: 4px;
    color: var(--text-color, #e2e2dc);
    cursor: pointer;
}

.authority-control {
    margin-bottom: 10px;
}

.authority-control label {
    display: block;
    font-size: 0.9em;
    margin-bottom: 5px;
}

.authority-control input[type="range"] {
    width: 100%;
}

.authority-display {
    text-align: center;
    font-size: 0.9em;
    margin-top: 5px;
}

.faction-list {
    margin-top: 10px;
}

.faction-item {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid var(--table-border, #555);
    border-radius: 4px;
    padding: 10px;
    margin-bottom: 8px;
}

.faction-item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
}

.faction-item-header h5 {
    margin: 0;
    color: var(--heading-color, #c9a338);
    font-size: 1em;
}

.faction-item-header button {
    padding: 2px 6px;
    font-size: 0.75em;
    background: rgba(255, 0, 0, 0.3);
    border: 1px solid #ff0000;
    border-radius: 3px;
    color: #fff;
    cursor: pointer;
}

.faction-power {
    margin-bottom: 5px;
}

.power-bar {
    width: 100%;
    height: 20px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 3px;
    overflow: hidden;
    position: relative;
}

.power-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--positive-color-1, #2ecc71), var(--positive-color-2, #27ae60));
    transition: width 0.3s;
}

.power-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 0.8em;
    font-weight: bold;
    color: #fff;
    text-shadow: 1px 1px 2px #000;
}

.faction-details {
    font-size: 0.85em;
    margin-top: 5px;
    opacity: 0.9;
}

.faction-details p {
    margin: 3px 0;
}

.faction-interactions {
    margin-top: 8px;
}

.faction-interactions strong {
    display: block;
    margin-bottom: 5px;
    font-size: 0.85em;
}

.interaction-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.interaction-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 3px 0;
    font-size: 0.8em;
}

.interaction-type-war {
    color: #e74c3c;
}

.interaction-type-alliance {
    color: #3498db;
}

.interaction-type-trade {
    color: #f39c12;
}

.interaction-item button {
    padding: 1px 4px;
    font-size: 0.7em;
    background: rgba(255, 0, 0, 0.3);
    border: 1px solid #ff0000;
    border-radius: 2px;
    color: #fff;
    cursor: pointer;
}

.event-log {
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid var(--table-border, #555);
    border-radius: 4px;
    padding: 10px;
    max-height: 300px;
    overflow-y: auto;
    font-size: 0.9em;
}

.event-log p {
    margin: 5px 0;
}

.no-events {
    opacity: 0.6;
    font-style: italic;
}

.event-entry {
    padding: 5px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.event-entry:last-child {
    border-bottom: none;
}

.event-region {
    font-weight: bold;
    color: var(--heading-color, #c9a338);
}
</style>
